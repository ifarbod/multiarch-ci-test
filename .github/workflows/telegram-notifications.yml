name: ğŸ“± Telegram Notifications

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    types: [opened, closed, reopened, synchronize, ready_for_review, converted_to_draft]
  pull_request_review:
    types: [submitted, edited, dismissed]
  pull_request_review_comment:
    types: [created, edited, deleted]
  issues:
    types: [opened, closed, reopened, edited, assigned, unassigned, labeled, unlabeled]
  issue_comment:
    types: [created, edited, deleted]
  release:
    types: [published, unpublished, created, edited, deleted, prereleased, released]
  workflow_run:
    workflows: ["*"]
    types: [completed, requested]
  deployment:
    types: [created]
  deployment_status:
    types: [created]
  check_run:
    types: [completed]

jobs:
  notify-telegram:
    runs-on: ubuntu-latest
    if: github.actor != 'dependabot[bot]'
    
    steps:
      - name: ğŸ“‹ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Push notifications
      - name: ğŸš€ Push Notification
        if: github.event_name == 'push'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸš€ *New Push to ${{ github.ref_name }}*
            
            ğŸ‘¤ *Author:* [${{ github.actor }}](https://github.com/${{ github.actor }})
            ğŸ“ *Commit:* `${{ github.event.head_commit.id }}`
            ğŸ’¬ *Message:* ${{ github.event.head_commit.message }}
            
            ğŸ”— [View Changes](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
            ğŸ“Š [Repository](https://github.com/${{ github.repository }})

      # Pull Request notifications
      - name: ğŸ“¬ Pull Request Opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ”„ *New Pull Request Opened*
            
            ğŸ‘¤ *Author:* [${{ github.event.pull_request.user.login }}](https://github.com/${{ github.event.pull_request.user.login }})
            ğŸ“‹ *Title:* ${{ github.event.pull_request.title }}
            ğŸŒ¿ *Branch:* `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`
            ğŸ“Š *Changes:* +${{ github.event.pull_request.additions }} -${{ github.event.pull_request.deletions }}
            
            ğŸ’­ *Description:*
            ${{ github.event.pull_request.body || 'No description provided' }}
            
            ğŸ”— [View Pull Request](${{ github.event.pull_request.html_url }})

      - name: âœ… Pull Request Merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âœ… *Pull Request Merged*
            
            ğŸ‘¤ *Author:* [${{ github.event.pull_request.user.login }}](https://github.com/${{ github.event.pull_request.user.login }})
            ğŸ‘¤ *Merged by:* [${{ github.actor }}](https://github.com/${{ github.actor }})
            ğŸ“‹ *Title:* ${{ github.event.pull_request.title }}
            ğŸŒ¿ *Branch:* `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`
            
            ğŸ”— [View Pull Request](${{ github.event.pull_request.html_url }})

      - name: âŒ Pull Request Closed
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == false
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âŒ *Pull Request Closed Without Merge*
            
            ğŸ‘¤ *Author:* [${{ github.event.pull_request.user.login }}](https://github.com/${{ github.event.pull_request.user.login }})
            ğŸ“‹ *Title:* ${{ github.event.pull_request.title }}
            ğŸŒ¿ *Branch:* `${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`
            
            ğŸ”— [View Pull Request](${{ github.event.pull_request.html_url }})

      # Pull Request Review notifications
      - name: ğŸ‘€ Pull Request Review Submitted
        if: github.event_name == 'pull_request_review' && github.event.action == 'submitted'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ‘€ *Pull Request Review: ${{ github.event.review.state }}*
            
            ğŸ‘¤ *Reviewer:* [${{ github.event.review.user.login }}](https://github.com/${{ github.event.review.user.login }})
            ğŸ“‹ *PR:* ${{ github.event.pull_request.title }}
            ${{ github.event.review.state == 'approved' && 'âœ…' || github.event.review.state == 'changes_requested' && 'ğŸ”„' || 'ğŸ’¬' }} *Status:* ${{ github.event.review.state }}
            
            ${{ github.event.review.body && format('ğŸ’­ *Comment:*\n{0}', github.event.review.body) || '' }}
            
            ğŸ”— [View Review](${{ github.event.review.html_url }})

      # Pull Request Review Comment notifications
      - name: ğŸ’¬ Review Comment
        if: github.event_name == 'pull_request_review_comment' && github.event.action == 'created'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ’¬ *New Review Comment*
            
            ğŸ‘¤ *Commenter:* [${{ github.event.comment.user.login }}](https://github.com/${{ github.event.comment.user.login }})
            ğŸ“‹ *PR:* ${{ github.event.pull_request.title }}
            ğŸ“ *File:* `${{ github.event.comment.path }}`
            
            ğŸ’­ *Comment:*
            ${{ github.event.comment.body }}
            
            ğŸ”— [View Comment](${{ github.event.comment.html_url }})

      # Issue notifications
      - name: ğŸ› Issue Opened
        if: github.event_name == 'issues' && github.event.action == 'opened'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ› *New Issue Opened*
            
            ğŸ‘¤ *Author:* [${{ github.event.issue.user.login }}](https://github.com/${{ github.event.issue.user.login }})
            ğŸ“‹ *Title:* ${{ github.event.issue.title }}
            ğŸ·ï¸ *Labels:* ${{ join(github.event.issue.labels.*.name, ', ') || 'None' }}
            
            ğŸ’­ *Description:*
            ${{ github.event.issue.body || 'No description provided' }}
            
            ğŸ”— [View Issue](${{ github.event.issue.html_url }})

      - name: âœ… Issue Closed
        if: github.event_name == 'issues' && github.event.action == 'closed'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âœ… *Issue Closed*
            
            ğŸ‘¤ *Closed by:* [${{ github.actor }}](https://github.com/${{ github.actor }})
            ğŸ“‹ *Title:* ${{ github.event.issue.title }}
            ğŸ·ï¸ *Labels:* ${{ join(github.event.issue.labels.*.name, ', ') || 'None' }}
            
            ğŸ”— [View Issue](${{ github.event.issue.html_url }})

      # Issue Comment notifications
      - name: ğŸ’¬ Issue Comment
        if: github.event_name == 'issue_comment' && github.event.action == 'created'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ’¬ *New Comment on Issue*
            
            ğŸ‘¤ *Commenter:* [${{ github.event.comment.user.login }}](https://github.com/${{ github.event.comment.user.login }})
            ğŸ“‹ *Issue:* ${{ github.event.issue.title }}
            
            ğŸ’­ *Comment:*
            ${{ github.event.comment.body }}
            
            ğŸ”— [View Comment](${{ github.event.comment.html_url }})

      # Release notifications
      - name: ğŸ‰ Release Published
        if: github.event_name == 'release' && github.event.action == 'published'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸ‰ *New Release Published*
            
            ğŸ‘¤ *Author:* [${{ github.event.release.author.login }}](https://github.com/${{ github.event.release.author.login }})
            ğŸ·ï¸ *Tag:* `${{ github.event.release.tag_name }}`
            ğŸ“‹ *Name:* ${{ github.event.release.name }}
            ${{ github.event.release.prerelease && 'ğŸš§ *Pre-release*' || '' }}
            
            ğŸ“ *Release Notes:*
            ${{ github.event.release.body || 'No release notes provided' }}
            
            ğŸ”— [View Release](${{ github.event.release.html_url }})
            ğŸ’¾ [Download Assets](${{ github.event.release.html_url }})

      # Workflow run notifications
      - name: âœ… Workflow Success
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âœ… *Workflow Completed Successfully*
            
            ğŸ”§ *Workflow:* ${{ github.event.workflow_run.name }}
            ğŸŒ¿ *Branch:* `${{ github.event.workflow_run.head_branch }}`
            ğŸ‘¤ *Triggered by:* [${{ github.event.workflow_run.triggering_actor.login }}](https://github.com/${{ github.event.workflow_run.triggering_actor.login }})
            â±ï¸ *Duration:* ${{ github.event.workflow_run.run_started_at }} - ${{ github.event.workflow_run.updated_at }}
            
            ğŸ”— [View Workflow Run](${{ github.event.workflow_run.html_url }})

      - name: âŒ Workflow Failure
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âŒ *Workflow Failed*
            
            ğŸ”§ *Workflow:* ${{ github.event.workflow_run.name }}
            ğŸŒ¿ *Branch:* `${{ github.event.workflow_run.head_branch }}`
            ğŸ‘¤ *Triggered by:* [${{ github.event.workflow_run.triggering_actor.login }}](https://github.com/${{ github.event.workflow_run.triggering_actor.login }})
            â±ï¸ *Duration:* ${{ github.event.workflow_run.run_started_at }} - ${{ github.event.workflow_run.updated_at }}
            
            ğŸ”— [View Failed Run](${{ github.event.workflow_run.html_url }})
            ğŸ” [Check Logs](${{ github.event.workflow_run.html_url }})

      # Deployment notifications
      - name: ğŸš€ Deployment Started
        if: github.event_name == 'deployment'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            ğŸš€ *Deployment Started*
            
            ğŸŒ *Environment:* ${{ github.event.deployment.environment }}
            ğŸŒ¿ *Branch:* `${{ github.event.deployment.ref }}`
            ğŸ‘¤ *Deployer:* [${{ github.event.deployment.creator.login }}](https://github.com/${{ github.event.deployment.creator.login }})
            
            ğŸ“‹ *Description:* ${{ github.event.deployment.description || 'No description provided' }}

      - name: âœ… Deployment Success
        if: github.event_name == 'deployment_status' && github.event.deployment_status.state == 'success'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âœ… *Deployment Successful*
            
            ğŸŒ *Environment:* ${{ github.event.deployment.environment }}
            ğŸŒ¿ *Branch:* `${{ github.event.deployment.ref }}`
            ğŸ‘¤ *Deployer:* [${{ github.event.deployment.creator.login }}](https://github.com/${{ github.event.deployment.creator.login }})
            
            ${{ github.event.deployment_status.target_url && format('ğŸ”— [View Deployment]({0})', github.event.deployment_status.target_url) || '' }}

      - name: âŒ Deployment Failed
        if: github.event_name == 'deployment_status' && github.event.deployment_status.state == 'failure'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âŒ *Deployment Failed*
            
            ğŸŒ *Environment:* ${{ github.event.deployment.environment }}
            ğŸŒ¿ *Branch:* `${{ github.event.deployment.ref }}`
            ğŸ‘¤ *Deployer:* [${{ github.event.deployment.creator.login }}](https://github.com/${{ github.event.deployment.creator.login }})
            
            ğŸ“‹ *Error:* ${{ github.event.deployment_status.description || 'No error details provided' }}

      # Check run notifications (for external CI/CD tools)
      - name: âœ… Check Run Success
        if: github.event_name == 'check_run' && github.event.check_run.conclusion == 'success' && github.event.check_run.app.name != 'GitHub Actions'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âœ… *External Check Passed*
            
            ğŸ”§ *Check:* ${{ github.event.check_run.name }}
            ğŸ“± *App:* ${{ github.event.check_run.app.name }}
            ğŸŒ¿ *Branch:* `${{ github.event.check_run.head_sha }}`
            
            ğŸ”— [View Details](${{ github.event.check_run.html_url }})

      - name: âŒ Check Run Failure
        if: github.event_name == 'check_run' && github.event.check_run.conclusion == 'failure' && github.event.check_run.app.name != 'GitHub Actions'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          format: markdown
          message: |
            âŒ *External Check Failed*
            
            ğŸ”§ *Check:* ${{ github.event.check_run.name }}
            ğŸ“± *App:* ${{ github.event.check_run.app.name }}
            ğŸŒ¿ *Branch:* `${{ github.event.check_run.head_sha }}`
            
            ğŸ“‹ *Summary:* ${{ github.event.check_run.output.summary || 'No details provided' }}
            
            ğŸ”— [View Details](${{ github.event.check_run.html_url }})
